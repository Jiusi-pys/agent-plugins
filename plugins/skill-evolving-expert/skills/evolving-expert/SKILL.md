# Self-Evolving Expert Skill

## æ¦‚è¿°

æœ¬ skill å®ç°ä¸“å®¶å‹ sub-agent çš„è‡ªæˆ‘è¿›åŒ–æœºåˆ¶ã€‚æ¯æ¬¡é—®é¢˜è§£å†³åè‡ªåŠ¨æå–å…³é”®çŸ¥è¯†ç‚¹ï¼ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œåç»­ä»»åŠ¡è‡ªåŠ¨æ£€ç´¢åº”ç”¨ã€‚

## æ ¸å¿ƒåŸåˆ™

1. **çŸ¥è¯†é—­ç¯**: è§£å†³é—®é¢˜ â†’ æå–çŸ¥è¯† â†’ å­˜å‚¨ç´¢å¼• â†’ æ£€ç´¢åº”ç”¨
2. **æ¸è¿›ç§¯ç´¯**: å•æ¬¡è§£å†³æ–¹æ¡ˆ â†’ é«˜é¢‘æ¨¡å¼æç‚¼ â†’ é¢†åŸŸçŸ¥è¯†ä½“ç³»
3. **æœ€å°å†—ä½™**: ç›¸ä¼¼é—®é¢˜åˆå¹¶ï¼Œä¿ç•™å·®å¼‚ç‚¹

## Session è‡ªåŠ¨åŒ– Hooks

è¯¥ skill åŒ…å«ä¸¤ä¸ªè‡ªåŠ¨åŒ– hooksï¼Œå®Œæ•´å®ç°è®°å¿†çš„è‡ªåŠ¨å½’æ¡£å’Œæ¢å¤ï¼š

### ğŸª on_session_start.sh - Session å¯åŠ¨é’©å­

**è‡ªåŠ¨è§¦å‘**: Claude Code å¯åŠ¨æ–° Session æ—¶

**åŠŸèƒ½**:
- è¯»å–çŸ¥è¯†åº“ç»Ÿè®¡ï¼ˆæ€»æ•°ã€å¸¸ç”¨æ–¹æ¡ˆã€æ ‡ç­¾åˆ†å¸ƒï¼‰
- æ˜¾ç¤ºä¸Šæ¬¡ Session ç”Ÿæˆçš„æ€»ç»“ (SUMMARY.md)
- è®©ä½ å¿«é€Ÿè¿›å…¥é¡¹ç›®çŠ¶æ€ï¼Œæ‰€æœ‰çŸ¥è¯†ä¸€ç›®äº†ç„¶

**ç¤ºä¾‹è¾“å‡º**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  çŸ¥è¯†åº“ - å¿«é€Ÿå¯åŠ¨æ€»ç»“                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š çŸ¥è¯†åº“ç»Ÿè®¡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ è§£å†³æ–¹æ¡ˆæ€»æ•°: 25 ä¸ª
â€¢ å·²æç‚¼æ¨¡å¼: 3 ä¸ª
â€¢ æ¶‰åŠæ ‡ç­¾: 12 ä¸ª

ğŸ† é«˜é¢‘é—®é¢˜è§£å†³ (æœ€å¸¸ç”¨ Top 3)
  1. dsoftbus èŠ‚ç‚¹å‘ç°å¤±è´¥æ’æŸ¥ (å‘½ä¸­: 8 æ¬¡)
  2. RK3588S udev è§„åˆ™é…ç½® (å‘½ä¸­: 5 æ¬¡)
  3. äº¤å‰ç¼–è¯‘ undefined reference è§£å†³ (å‘½ä¸­: 4 æ¬¡)
```

### ğŸª on_session_end.sh - Session ç»“æŸé’©å­

**è‡ªåŠ¨è§¦å‘**: æ‰§è¡Œ `/clear` æˆ– `/exit` æ—¶

**åŠŸèƒ½**:
- æ‰«æçŸ¥è¯†åº“ï¼Œè¯†åˆ«é«˜é¢‘è§£å†³æ–¹æ¡ˆï¼ˆå‡ºç° â‰¥3 æ¬¡ï¼‰
- ç”Ÿæˆ SUMMARY.mdï¼ˆMarkdown æ ¼å¼æ€»ç»“ï¼Œä¸‹æ¬¡ Session ä¼šæ˜¾ç¤ºï¼‰
- åˆ›å»ºæ—¶é—´æˆ³å¼æ¡£æ¡ˆå¤‡ä»½ï¼ˆä¿å­˜å®Œæ•´å†å²çŠ¶æ€ï¼‰
- åˆ†æè¿‡æœŸè§£å†³æ–¹æ¡ˆï¼ˆ90å¤©æœªä½¿ç”¨ï¼‰

**ç”Ÿæˆç‰©**:
- `knowledge/SUMMARY.md` - çŸ¥è¯†åº“æ€»ç»“
- `knowledge/archives/knowledge_archive_YYYYMMDD_HHMMSS.tar.gz` - å®Œæ•´å¤‡ä»½
- `knowledge/archives/manifest.txt` - å¤‡ä»½æ¸…å•

**ç¤ºä¾‹è¾“å‡º**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              çŸ¥è¯†åº“å½’æ¡£ä¸ç»„ç»‡å®Œæˆ                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… å·²å®Œæˆçš„æ“ä½œ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  âœ“ çŸ¥è¯†åº“æ‰«æ
  âœ“ é«˜é¢‘æ¨¡å¼æ£€æŸ¥
  âœ“ ç”Ÿæˆæ€»ç»“æ–‡æ¡£
  âœ“ æ—¶é—´æˆ³æ¡£æ¡ˆå¤‡ä»½
  âœ“ æ¸…ç†è¿‡æœŸæ¡ç›®åˆ†æ

ğŸ“Š æœ¬æ¬¡å½’æ¡£ç»Ÿè®¡:
  â€¢ è§£å†³æ–¹æ¡ˆ: 25 ä¸ª
  â€¢ å·²æç‚¼æ¨¡å¼: 3 ä¸ª
  â€¢ æ¶‰åŠæ ‡ç­¾: 12 ä¸ª
```

---

## å·¥ä½œæµç¨‹

### Phase 1: ä»»åŠ¡å¯åŠ¨å‰ - çŸ¥è¯†æ£€ç´¢

```bash
# æ£€ç´¢ç›¸å…³å†å²çŸ¥è¯†
cat knowledge/index.json | jq '.solutions[] | select(.tags | contains(["å…³é”®è¯"]))'
```

**å¿…é¡»æ‰§è¡Œ**ï¼š
1. è¯»å– `knowledge/index.json` æ£€ç´¢ç›¸å…³æ¡ç›®
2. å¦‚æœ‰åŒ¹é…ï¼Œè¯»å–å¯¹åº” solution æ–‡ä»¶
3. åŸºäºå†å²çŸ¥è¯†åˆ¶å®šè§£å†³æ–¹æ¡ˆ

### Phase 2: ä»»åŠ¡æ‰§è¡Œ

æ­£å¸¸æ‰§è¡Œä¸“å®¶ä»»åŠ¡ï¼Œè®°å½•ï¼š
- é—®é¢˜æè¿°
- å°è¯•çš„æ–¹æ¡ˆï¼ˆå«å¤±è´¥çš„ï¼‰
- æœ€ç»ˆè§£å†³æ–¹æ¡ˆ
- å…³é”®å‘½ä»¤/ä»£ç 

### Phase 3: ä»»åŠ¡å®Œæˆå - çŸ¥è¯†æå–

**è§¦å‘æ¡ä»¶**ï¼ˆæ»¡è¶³ä»»ä¸€ï¼‰ï¼š
- è§£å†³äº†æ–°é—®é¢˜
- å‘ç°äº†æ›´ä¼˜æ–¹æ¡ˆ
- è¸©å‘å¹¶æ‰¾åˆ°åŸå› 

**æå–æ¨¡æ¿**ï¼š

```markdown
## é—®é¢˜æ‘˜è¦
{ä¸€å¥è¯æè¿°}

## ä¸Šä¸‹æ–‡
- ç¯å¢ƒ: {OS/ç¡¬ä»¶/ç‰ˆæœ¬}
- å‰ç½®æ¡ä»¶: {ä¾èµ–/é…ç½®}

## è§£å†³æ–¹æ¡ˆ
{æ ¸å¿ƒæ­¥éª¤ï¼Œç²¾ç®€åˆ°å¯ç›´æ¥å¤ç”¨}

## å…³é”®ç‚¹
- {è¸©å‘ç‚¹1}
- {å…³é”®å‘½ä»¤/é…ç½®}

## æ ‡ç­¾
{tag1}, {tag2}, {tag3}
```

### Phase 4: çŸ¥è¯†å­˜å‚¨

```bash
# 1. ç”Ÿæˆè§£å†³æ–¹æ¡ˆæ–‡ä»¶
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
TOPIC="ç®€çŸ­ä¸»é¢˜"
echo "{solution_content}" > knowledge/solutions/${TIMESTAMP}_${TOPIC}.md

# 2. æ›´æ–°ç´¢å¼•
# è¯»å–ç°æœ‰ç´¢å¼•ï¼Œè¿½åŠ æ–°æ¡ç›®
```

**ç´¢å¼•ç»“æ„**ï¼š
```json
{
  "solutions": [
    {
      "id": "20250116_153000_dsoftbus_init",
      "title": "dsoftbus åˆå§‹åŒ–å¤±è´¥æ’æŸ¥",
      "tags": ["dsoftbus", "openharmony", "rk3588s", "init"],
      "file": "solutions/20250116_153000_dsoftbus_init.md",
      "created": "2025-01-16",
      "hit_count": 0
    }
  ],
  "patterns": [
    {
      "category": "dsoftbus",
      "file": "patterns/dsoftbus.md",
      "solution_refs": ["20250116_153000_dsoftbus_init"]
    }
  ]
}
```

### Phase 5: æ¨¡å¼æç‚¼ï¼ˆå‘¨æœŸæ€§ï¼‰

å½“åŒä¸€ tag ä¸‹ solutions æ•°é‡ â‰¥ 3 æ—¶ï¼Œè§¦å‘æ¨¡å¼æç‚¼ï¼š

1. æ±‡æ€»ç›¸å…³ solutions
2. æå–å…±æ€§é—®é¢˜ä¸é€šç”¨è§£æ³•
3. å†™å…¥ `patterns/{category}.md`
4. æ›´æ–°ç´¢å¼•ä¸­çš„ pattern å¼•ç”¨

## æ£€ç´¢ç­–ç•¥

**ä¼˜å…ˆçº§**ï¼š
1. patternsï¼ˆé«˜ç½®ä¿¡åº¦ï¼Œå·²éªŒè¯å¤šæ¬¡ï¼‰
2. solutionsï¼ˆå•æ¬¡ç»éªŒï¼Œéœ€è¯„ä¼°é€‚ç”¨æ€§ï¼‰
3. æ— åŒ¹é…æ—¶ï¼Œæ­£å¸¸æ¨ç†

**æ£€ç´¢å‘½ä»¤**ï¼š
```bash
# æŒ‰æ ‡ç­¾æ£€ç´¢
jq '.solutions[] | select(.tags | any(. == "dsoftbus"))' knowledge/index.json

# æŒ‰æ ‡é¢˜æ¨¡ç³ŠåŒ¹é…
jq '.solutions[] | select(.title | test("init"; "i"))' knowledge/index.json

# è·å–é«˜é¢‘è§£å†³æ–¹æ¡ˆ
jq '.solutions | sort_by(-.hit_count) | .[0:5]' knowledge/index.json
```

## Sub-Agent è°ƒç”¨ç¤ºä¾‹

ä¸» agent è°ƒç”¨æ—¶ï¼š

```
Task: è§£å†³ dsoftbus é€šä¿¡é—®é¢˜

dispatch_agent(
  agent_name="openharmony_expert",
  task="æ’æŸ¥ RK3588S ä¸Š dsoftbus èŠ‚ç‚¹å‘ç°å¤±è´¥",
  context={
    "board": "RK3588S",
    "os": "KaihongOS 4.0",
    "symptom": "LNN å›è°ƒæ— è§¦å‘"
  }
)
```

Expert sub-agent æ‰§è¡Œæµç¨‹ï¼š
1. æ£€ç´¢ `tags: [dsoftbus, LNN, èŠ‚ç‚¹å‘ç°]`
2. æ‰¾åˆ°å†å²æ–¹æ¡ˆåˆ™ä¼˜å…ˆå‚è€ƒ
3. æ‰§è¡Œæ’æŸ¥
4. è§£å†³åæå–æ–°çŸ¥è¯†ç‚¹å­˜å‚¨

## çŸ¥è¯†æ¸…ç†è§„åˆ™

- hit_count = 0 ä¸” created > 90å¤©ï¼šæ ‡è®°å¾…æ¸…ç†
- è¢« pattern åˆå¹¶çš„ solutionsï¼šä¿ç•™å¼•ç”¨ï¼Œå¯å½’æ¡£åŸæ–‡
- æ˜ç¡®è¿‡æ—¶çš„æ–¹æ¡ˆï¼šæ·»åŠ  `deprecated: true` æ ‡è®°

## Agent è§„èŒƒ

è¯·æŸ¥çœ‹ [AGENT_SPEC.md](../AGENT_SPEC.md) äº†è§£å®Œæ•´çš„ Agent è¡Œä¸ºè§„èŒƒã€‚

**æ ¸å¿ƒåŸåˆ™**:

1. **å®Œæ•´æ€§**: è®°å½•æ‰€æœ‰å°è¯•çš„æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å¤±è´¥çš„
2. **å¼•ç”¨ä¼˜å…ˆ**: é¿å…å†—ä½™å¤åˆ¶ï¼Œä½¿ç”¨ `ref:*` æ ¼å¼å¼•ç”¨æ–‡æ¡£
3. **YAML Header**: æ‰€æœ‰æ–‡æ¡£å¿…é¡»åŒ…å« YAML frontmatter
4. **Session è®°å½•**: å®Œæ•´è®°å½•å¯¹è¯å†å²ã€æŒ‡ä»¤ã€æ–‡æ¡£é“¾æ¥

**å…³é”®å·¥å…·**:

```bash
# å¯¹è¯å’Œå¼•ç”¨ç®¡ç†
./scripts/conversation_recorder.sh init                    # åˆå§‹åŒ–è®°å½•ç³»ç»Ÿ
./scripts/conversation_recorder.sh create-session <id>     # åˆ›å»ºæ–° Session
./scripts/conversation_recorder.sh log-instruction <id> <cmd>
                                                          # è®°å½•æŒ‡ä»¤
./scripts/conversation_recorder.sh update-metadata <id>    # æ›´æ–°å…ƒæ•°æ®
./scripts/conversation_recorder.sh add-reference <cat> <id> <title> <url>
                                                          # æ·»åŠ å¼•ç”¨

# çŸ¥è¯†åº“ç®¡ç†
./scripts/knowledge_manager.sh add "æ ‡é¢˜" "tags" file.md   # æ·»åŠ è§£å†³æ–¹æ¡ˆ
./scripts/knowledge_manager.sh stats                       # ç»Ÿè®¡ä¿¡æ¯
./scripts/knowledge_manager.sh check-merge                 # æ£€æŸ¥å¯æç‚¼æ¨¡å¼
```

## é…ç½®é¡¹

```json
{
  "auto_extract": true,
  "extract_threshold": "new_solution|better_solution|pitfall",
  "pattern_merge_threshold": 3,
  "knowledge_base_path": "./knowledge",
  "max_solutions_per_tag": 50,
  "yaml_compliance_required": true,
  "reference_system_enabled": true,
  "session_recording_enabled": true
}
```

## åˆå§‹åŒ–å‘½ä»¤

```bash
# åˆå§‹åŒ–çŸ¥è¯†åº“
mkdir -p knowledge/{solutions,patterns,session_logs,conversation_history,references}
echo '{"solutions":[],"patterns":[]}' > knowledge/index.json

# åˆå§‹åŒ–å¯¹è¯å’Œå¼•ç”¨ç³»ç»Ÿ
./scripts/conversation_recorder.sh init
```
